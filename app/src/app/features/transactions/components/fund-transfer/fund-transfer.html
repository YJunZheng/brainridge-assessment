<div class="container mt-5 mb-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white p-3">
          <div class="d-flex align-items-center">
            <i class="bi bi-arrow-left-right me-3"></i>
            <h4 class="mb-1">Transfer Funds</h4>
          </div>
          <small>Move money between your accounts</small>
        </div>

        <div class="card-body">
          <form [formGroup]="transferForm" (ngSubmit)="onSubmit()">
            <!-- From Account Field -->
            <div class="mb-3">
              <label for="fromAccountId" class="form-label">From Account</label>
              <select
                class="form-select"
                id="fromAccountId"
                formControlName="fromAccountId"
                [class.is-invalid]="
                  transferForm.get('fromAccountId')?.touched &&
                  transferForm.get('fromAccountId')?.invalid
                "
              >
                <option value="">Select source account</option>
                @for (account of accounts(); track account.id) {
                <option [value]="account.id">
                  {{ account.accountName }} ({{ account.accountType }}) -
                  {{ formatCurrency(account.balance) }}
                </option>
                }
              </select>
              @if (transferForm.get('fromAccountId')?.touched &&
              transferForm.get('fromAccountId')?.invalid) {
              <div class="invalid-feedback d-block">
                {{ getErrorMessage('From Account') }}
              </div>
              }
            </div>

            <!-- To Account Field -->
            <div class="mb-3">
              <label for="toAccountId" class="form-label">To Account</label>
              <select
                class="form-select"
                id="toAccountId"
                formControlName="toAccountId"
                [class.is-invalid]="
                  transferForm.get('toAccountId')?.touched &&
                  transferForm.get('toAccountId')?.invalid
                "
              >
                <option value="">Select destination account</option>
                @for (account of accounts(); track account.id) {
                <option [value]="account.id">
                  {{ account.accountName }} ({{ account.accountType }}) -
                  {{ formatCurrency(account.balance) }}
                </option>
                }
              </select>
              @if (transferForm.get('toAccountId')?.touched &&
              transferForm.get('toAccountId')?.invalid) {
              <div class="invalid-feedback d-block">
                {{ getErrorMessage('To Account') }}
              </div>
              }
            </div>

            <!-- Form-level error for same account selection -->
            @if (transferForm.touched && transferForm.hasError('sameAccount')) {
            <div class="alert alert-danger">
              <i class="bi bi-exclamation-triangle me-2"></i>
              {{ getFormError() }}
            </div>
            }

            <!-- Amount Field -->
            <div class="mb-3">
              <label for="amount" class="form-label">Transfer Amount</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input
                  type="number"
                  class="form-control"
                  id="amount"
                  formControlName="amount"
                  placeholder="0.00"
                  min="0.01"
                  max="1000000"
                  step="0.01"
                  [class.is-invalid]="
                    (transferForm.get('amount')?.touched && transferForm.get('amount')?.invalid) ||
                    transferForm.hasError('insufficientFunds')
                  "
                />
              </div>
              @if (transferForm.get('fromAccountId')?.value) {
              <div class="form-text">
                Available:
                {{ formatCurrency(getAccountBalance(transferForm.get('fromAccountId')?.value)) }}
              </div>
              } @if (transferForm.get('amount')?.touched && (transferForm.get('amount')?.invalid || transferForm.hasError('insufficientFunds'))) {
              <div class="invalid-feedback d-block">
                {{ getErrorMessage('Amount') }}
              </div>
              }
            </div>
          </form>
        </div>

        <div class="card-footer bg-light border-0 p-3">
          <div class="d-flex justify-content-end gap-2">
            <app-custom-button
              text="Clear"
              color="danger"
              icon="bi-arrow-clockwise"
              (clicked)="clearForm()"
            >
            </app-custom-button>
            <app-custom-button
              text="Transfer Funds"
              color="primary"
              icon="bi-arrow-left-right"
              [disabled]="transferForm.invalid"
              (clicked)="onSubmit()"
            >
            </app-custom-button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
